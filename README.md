# Проектная работа "Веб-ларёк"

Приложение "Веб-ларёк" — это учебный проект по итогам модуля ООП и TypeScript (спринты 8-9) курса Фронтенд-разработчик от Яндекс Практикум.
Функционал приложения позволяет посмотреть каталог товаров, добавить их в корзину, оформить заказ.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения
Код приложения разделен на слои согласно парадигме *MVP (Model-View-Presenter)*: 
- слой данных, отвечает за хранение и изменение данных;
- слой представления, отвечает за отображение данных на странице;
- презентер, отвечает за связь представления и данных.

## Базовый код

### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

## Слой данных / Model-V-P 

### Описание категорий товара:
`type CategoryType =
 | 'другое'
 | 'софт-скил'
 | 'дополнительное'
 | 'кнопка'
 | 'хард-скил';`.

### Описание ошибки валидации форм:
`type FormErrors = Partial<Record<keyof IOrderForm, string>>;`.

### Интерфейс карточки товара в каталоге IProduct:
- `id: string;` - уникальный ID;
- `description: string;` - описание товара;
- `image: string;` - ссылка на картинку;
- `title: string;` - название товара;
- `category: CategoryType;` - категория товара; 
- `price: number | null;` - цена товара выражается числом либо null, если в качестве цены указывается «Бесценно»;
- `selected: boolean;` - наличие товара в корзине.

### Интерфейс состояния приложения IAppState, который используется для хранения и работы с карточками и корзиной:
- `basket: Product[];` - корзина с товарами;
- `store: Product[];` - массив карточек товара;
- `order: IOrder;` - информация о заказе при оформлении покупки;
- `formErrors: FormErrors;` - ошибки при заполнении форм;
- `addToBasket(value: Product): void;` - метод для добавления товара в корзину;
- `deleteFromBasket(id: string): void;` - метод для удаления товара из корзины;
- `clearBasket(): void;` - метод для очистки корзины;
- `getBasketAmount(): number;` - метод для подсчёта количества товаров, добавленных в корзину;
- `getTotalBasketPrice(): number;` - метод для суммирования цен товаров, добавленных в корзину;
- `setItems(): void;` - метод для добавления ID товара в корзине в поле items для order;
- `setOrderField(field: keyof IOrderForm, value: string): void;` - метод для заполнения полей email, phone, address, payment в order;
- `validateContacts(): boolean;` - валидация форм для модального окна "Контакты";
- `validateOrder(): boolean;` - валидация форм для модального окна "Заказ";
- `refreshOrder(): boolean;` - очистить order после покупки товаров;
- `setStore(items: IProduct[]): void;` - метод для преобразования данных, полученных с сервера, в тип данных приложения;
- `resetSelected(): void;` - метод для обновления поля selected во всех товарах после совершения покупки.

### Интерфейс IOrder, описывающий поля заказа товара:
- `items: string[];` - массив ID купленных товаров;
- `payment: string;` - способ оплаты;
- `total: number;` - сумма заказа;
- `address: string;` - адрес доставки;
- `email: string;` - электронная почта;
- `phone: string;` - номер телефона.

### Интерфейс карточки товара ICard:
- `id: string;` - уникальный ID;
- `description: string;` - описание товара;
- `image: string;` - ссылка на картинку;
- `title: string;` - название товара;
- `category: CategoryType;` - категория товара; 
- `price: number | null;` - цена товара выражается числом либо null, если в качестве цены указывается «Бесценно»;
- `selected: boolean;` - наличие товара в корзине.

### Интерфейс для отображения стартовой страницы IPage:
- `counter: number;` - счётчик товаров в корзине;
- `store: HTMLElement[]` - массив карточек с товарами;
- `locked: boolean;` - переключатель для блокировки, отключает прокрутку страницы.

### Интерфейс корзины товаров IBasket:
- `list: HTMLElement[];` - массив элементов li с товаром;
- `price: number;` - общая цена товаров в корзине.

### Интерфейс модального окна заказа товаров IOrder {
- `address: string;` - адрес доставки;
- `payment: string;` - способ оплаты.

### Интерфейс модального окна для указания контактов IContacts:
- `phone: string;` - номер телефона;
- `email: string;` - адрес электронной почты.

### Класс Model
Представляет собой абстрактную базовую модель для работы с данными и событиями в приложении.\ 
Конструктор принимает для хранения данные объекта и эмиттер событий:\
`constructor(data: Partial<T>, protected events: IEvents)`\
Метод `emitChanges(event: string, payload?: object) {}` отвечает за вызов событий.


## Слой представления / M-View-P

### Класс Component
Представляет собой абстрактный базовый класс для создания и управления элементами интерфейса.
Конструктор доступен в пределах самого класса и его подклассов и принимает родительский HTML-элемент, в котором будет размещен компонент:
 `protected constructor(protected readonly container: HTMLElement);`
Методы:
- `toggleClass(element: HTMLElement, className: string, force?: boolean): void;` – переключить класс;
- `protected setText(element: HTMLElement, value: string): void;` - установить текстовое содержимое;
- `setDisabled(element: HTMLElement, state: boolean): void;` - сменить статус блокировки;
- `protected setHidden(element: HTMLElement): void;` - скрыть;
- `protected setVisible(element: HTMLElement): void;` - показать;
- `protected setImage(el: HTMLImageElement, src: string, alt?: string): void;` - установить изображение с альтернативным текстом;
- `render(data?: Partial<T>): HTMLElement;` - вернуть корневой DOM-элемент.

### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

### Класс IAppState
Описывает состояние приложения, наследует данные интерфейса IAppState. Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- `basket: Product[] = [];` - корзина с товарами;
- `store: Product[];` - массив со всеми товарами;
- `order: IOrder = {
  items: [],
  payment: '',
  total: null,
  address: '',
  email: '',
  phone: '',
 };` - объект заказа пользователя;
- `formErrors: FormErrors = {};` - объект с ошибками форм;
Для взаимодействия с данными используются следующие методы:
- `addToBasket(value: Product): void;` - метод для добавления товара в корзину;
- `deleteFromBasket(id: string): void;` - метод для удаления товара из корзины;
- `clearBasket(): void;` - метод для очистки корзины;
- `getBasketAmount(): number;` - метод для подсчёта количества товаров, добавленных в корзину;
- `getTotalBasketPrice(): number;` - метод для суммирования цен товаров, добавленных в корзину;
- `setItems(): void;` - метод для добавления ID товара в корзине в поле items для order;
- `setOrderField(field: keyof IOrderForm, value: string): void;` - метод для заполнения полей email, phone, address, payment в order;
- `validateContacts(): boolean;` - валидация форм для модального окна "Контакты";
- `validateOrder(): boolean;` - валидация форм для модального окна "Заказ";
- `refreshOrder(): boolean;` - очистить order после покупки товаров;
- `setStore(items: IProduct[]): void;` - метод для преобразования данных, полученных с сервера, в тип данных приложения;
- `resetSelected(): void;` - метод для обновления поля selected во всех товарах после совершения покупки.

### Класс Page
Описывает главную страницу.
В полях класса хранятся следующие данные:
- `protected _counter: HTMLElement;
 protected _store: HTMLElement;
 protected _wrapper: HTMLElement;
 protected _basket: HTMLElement;` - ссылки на внутренние элементы;
Конструктор принимает родительский элемент и обработчик событий.
Добавить конструктор
Используются следующие сеттеры:
- `set counter(value: number);` - для счётчика товаров в корзине;
- `set store(items: HTMLElement[]);` - для карточек товаров на странице;
- `set locked(value: boolean);` - для блока прокрутки.

### Класс Card
Описывает карточку товара.
В полях класса хранятся следующие данные:
` protected _title: HTMLElement;
 protected _image: HTMLImageElement;
 protected _category: HTMLElement;
 protected _price: HTMLElement;
 protected _button: HTMLButtonElement;`
Конструктор принимает имя блока, родительский контейнер и объект с колбэк функциями: 
`constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions);`
Используются сеттеры и геттеры:
- `set id(value: string);
 get id(): string;` - сеттер и геттер для уникального ID;
- `set title(value: string);
 get title(): string;` - сеттер и гетер для названия товара;
- `set image(value: string);` - сеттер для изображения;
- `set selected(value: boolean);` - сеттер для определения, выбран товар или нет
- `set price(value: number | null);` - сеттер для цены товара
- `set category(value: CategoryType);` - сеттер для категории товара

### Класс Basket 
Описывает корзину товаров.
В полях класса хранятся следующие данные:
 `protected _list: HTMLElement;
 protected _price: HTMLElement;
 protected _button: HTMLButtonElement;`
Конструктор принимает имя блока, родительский элемент и обработчик событий:
` constructor(protected blockName: string, container: HTMLElement, protected events: IEvents);`
Используются сеттеры и методы:
` set price(price: number);` – сеттер для общей цены;
 `set list(items: HTMLElement[]);` – сеттер для списка товаров;
 `disableButton(): void;` – метод, отключающий кнопку "Оформить";
 `refreshIndices(): void;` – метод для обновления индексов таблички при удалении товара из корзины.

### Класс Order
Описывает модальное окно для указания способа оплаты и адреса доставки при оформлении заказа.
В полях класса хранятся следующие данные:
`protected _card: HTMLButtonElement;
 protected _cash: HTMLButtonElement;`
Конструктор принимает имя блока, родительский элемент и обработчик событий:
` constructor(protected blockName: string, container: HTMLFormElement, protected events: IEvents);`
Используется методы `disableButtons(): void;`, отключающий подсвечивание кнопок.

### Класс Contacts
Описывает модальное окно для заполнения контактных данных при оформлении заказа.
Конструктор принимает родительский элемент и обработчик событий:
`constructor(container: HTMLFormElement, events: IEvents);`

## Слой коммуникации / M-V-Presenter

Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список событий, которые могут генерироваться в системе:
- `items:changed` – перерисовывает список товаров на странице при его изменении;
- `card:select` – открывает модальное окно с подробным описанием товара по клику на карточку товара на главной странице;
- `card:toBasket` – добавляет выбранный товар в корзину;
- `basket:open` – открывает модальное окно по клику на кнопку «Корзина»; 
- `basket:delete` – удаляет выбранный товар из массива добавленных в корзину товаров;
- `basket:order` – открывает модальное окно с формой для заполнения способа оплаты и адреса доставки при оформлении заказа;
- `order:submit` – переходит на второй этап оформления заказа, где необходимо внести номер телефона и электронную почту; 
- `contacts:submit` – переходит на модальное окно об успешном оформлении заказа;
- `orderInput:change` – проверяет текстовые данные, которые вносятся пользователем в формы при оформлении заказа;
- `orderFormErrors:change` – проверяет внесение всех обязательных данных в форме для заполнения способа оплаты и адреса;
- `contactsFormErrors:change` – проверяет внесение всех обязательных данных в форме для заполнения номера телефона и электронной почты;
- `order:success` – открывает модальное окно, сообщающее об успешной оплате;
- `modal:close` – закрывает модальное окно по клику на кнопку закрытия или по клику вне модального окна.
